{% extends "base.html" %}

{% block title %}{{ product.name }} - SZABIST MART{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<div class="bg-gray-50 py-4 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="flex items-center space-x-2 text-gray-600">
            <a href="/" class="hover:text-brand-green transition">Home</a>
            <span>/</span>
            <a href="/products" class="hover:text-brand-green transition">Products</a>
            <span>/</span>
            <span class="text-gray-900 font-semibold">{{ product.name }}</span>
        </div>
    </div>
</div>

<!-- Product Detail -->
<section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
            <!-- Product Image -->
            <div>
                <div class="relative overflow-hidden bg-gray-100 rounded-lg">
                    <img 
                        src="{{ product.image }}" 
                        alt="{{ product.name }}" 
                        class="w-full h-96 object-cover"
                        loading="lazy"
                        crossorigin="anonymous"
                        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-size=%2224%22 fill=%22%23999%22%3EImage Not Available%3C/text%3E%3C/svg%3E'"
                    >
                    {% if product.stock == 0 %}
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <span class="text-white font-bold text-2xl">Out of Stock</span>
                        </div>
                    {% endif %}
                </div>

                <!-- Product Images Gallery -->
                <div class="grid grid-cols-4 gap-3 mt-4">
                    <div class="border-2 border-brand-green rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition">
                        <img 
                            src="{{ product.image }}" 
                            alt="Thumbnail 1" 
                            class="w-full h-20 object-cover"
                            loading="lazy"
                            crossorigin="anonymous"
                        >
                    </div>
                </div>
            </div>

            <!-- Product Information -->
            <div>
                <!-- Category & Rating -->
                <div class="flex items-center space-x-3 mb-4">
                    <span class="inline-block bg-blue-100 text-brand-blue px-3 py-1 rounded-full text-sm font-semibold">
                        {{ product.category }}
                    </span>
                    <div class="flex text-yellow-400">
                        ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
                    </div>
                </div>

                <!-- Product Name -->
                <h1 class="text-4xl font-bold text-gray-900 mb-3">{{ product.name }}</h1>

                <!-- Price -->
                <div class="flex items-baseline space-x-3 mb-6">
                    <span class="text-5xl font-bold text-brand-green">‚Çπ{{ product.price }}</span>
                    <span class="text-xl text-gray-500 line-through">‚Çπ{{ (product.price * 1.2)|int }}</span>
                    <span class="bg-green-100 text-brand-green px-3 py-1 rounded-full text-sm font-semibold">
                        20% OFF
                    </span>
                </div>

                <!-- Stock Status -->
                <div class="mb-6">
                    {% if product.stock == 0 %}
                        <p class="text-lg text-red-600 font-semibold">üî¥ Out of Stock</p>
                    {% elif product.stock < 5 %}
                        <p class="text-lg text-orange-600 font-semibold">‚ö†Ô∏è Only {{ product.stock }} left in stock</p>
                    {% else %}
                        <p class="text-lg text-green-600 font-semibold">‚úì {{ product.stock }} in stock</p>
                    {% endif %}
                </div>

                <!-- Description -->
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-2">Description</h3>
                    <p class="text-gray-600 leading-relaxed">{{ product.description }}</p>
                </div>

                <!-- Product Details -->
                <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                    <div>
                        <p class="text-gray-600 text-sm">Package Size</p>
                        <p class="text-lg font-semibold text-gray-900">{{ product.quantity }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm">Product ID</p>
                        <p class="text-lg font-semibold text-gray-900">#{{ product.product_id }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm">Category</p>
                        <p class="text-lg font-semibold text-gray-900">{{ product.category }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm">Availability</p>
                        <p class="text-lg font-semibold {% if product.stock > 0 %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if product.stock > 0 %}In Stock{% else %}Out of Stock{% endif %}
                        </p>
                    </div>
                </div>

                <!-- Quantity Selector (Admin - Stock Update) -->
                <div class="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                    <h4 class="font-semibold text-gray-900 mb-3">Admin: Update Stock</h4>
                    <div class="flex gap-3 items-center">
                        <input 
                            type="number" 
                            id="stockInput" 
                            value="{{ product.stock }}" 
                            min="0" 
                            class="w-20 px-3 py-2 border-2 border-blue-200 rounded-lg focus:border-brand-green focus:outline-none"
                        >
                        <button 
                            data-product-id="{{ product.product_id }}"
                            onclick="updateStock(this.getAttribute('data-product-id'))" 
                            class="bg-gradient-to-r from-brand-blue to-brand-green text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition"
                        >
                            Update Stock
                        </button>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Set quantity to 0 to mark as out of stock</p>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4">
                    <button 
                        {% if product.stock > 0 %}
                            onclick="alert('Product added to cart!')"
                            class="flex-1 bg-gradient-to-r from-brand-blue to-brand-green text-white py-3 rounded-lg font-semibold hover:shadow-xl transition"
                        {% else %}
                            disabled
                            class="flex-1 bg-gray-400 text-white py-3 rounded-lg font-semibold cursor-not-allowed"
                        {% endif %}
                    >
                        üõí {% if product.stock > 0 %}Add to Cart{% else %}Out of Stock{% endif %}
                    </button>
                    <button 
                        onclick="alert('Added to wishlist!')"
                        class="px-6 py-3 border-2 border-brand-green text-brand-green rounded-lg font-semibold hover:bg-green-50 transition"
                    >
                        ‚ù§Ô∏è Wishlist
                    </button>
                </div>

                <!-- Delivery Info -->
                <div class="mt-8 p-4 bg-green-50 rounded-lg border-2 border-green-200">
                    <h4 class="font-semibold text-gray-900 mb-3">Delivery Information</h4>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li>‚úì Free shipping on orders above ‚Çπ500</li>
                        <li>‚úì Expected delivery in 2-3 business days</li>
                        <li>‚úì 100% original product guarantee</li>
                        <li>‚úì Easy returns within 7 days</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="mt-16 pt-12 border-t border-gray-200">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Related Products</h2>

            {% set related_products = [] %}
            {% for p in products %}
                {% if p.category == product.category and p.product_id != product.product_id %}
                    {% set _ = related_products.append(p) %}
                {% endif %}
            {% endfor %}

            {% if related_products|length > 0 %}
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    {% for rel_product in related_products[:4] %}
                        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition transform hover:scale-105">
                            <div class="relative overflow-hidden bg-gray-200 h-40">
                                <img 
                                    src="{{ rel_product.image }}" 
                                    alt="{{ rel_product.name }}" 
                                    class="w-full h-full object-cover hover:scale-110 transition duration-300"
                                    loading="lazy"
                                    crossorigin="anonymous"
                                    onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-size=%2224%22 fill=%22%23999%22%3EImage Not Available%3C/text%3E%3C/svg%3E'"
                                >
                                {% if rel_product.stock == 0 %}
                                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                        <span class="text-white font-bold text-xs">Out of Stock</span>
                                    </div>
                                {% endif %}
                            </div>

                            <div class="p-4">
                                <h3 class="font-bold text-gray-800 mb-1 line-clamp-2">{{ rel_product.name }}</h3>
                                <p class="text-sm text-gray-600 mb-3">{{ rel_product.category }}</p>

                                <div class="flex justify-between items-center">
                                    <span class="text-xl font-bold text-brand-green">‚Çπ{{ rel_product.price }}</span>
                                </div>

                                <a href="/product/{{ rel_product.product_id }}" class="block mt-3 bg-gradient-to-r from-brand-blue to-brand-green text-white py-2 rounded-lg text-center text-sm font-semibold hover:shadow-lg transition">
                                    View
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-600 text-center py-8">No related products found</p>
            {% endif %}
        </div>
    </div>
</section>

{% endblock %}

{% block extra_scripts %}
<script>
    function updateStock(productId) {
        const stockInput = document.getElementById('stockInput');
        const newStock = parseInt(stockInput.value);

        if (newStock < 0) {
            alert('Stock cannot be negative');
            return;
        }

        fetch(`/update/${productId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ stock: newStock })
        })
        .then(response => response.json())
        .then(data => {
            alert('Stock updated successfully!');
            // Optionally refresh the page
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating stock');
        });
    }
</script>
{% endblock %}